
-- 1. 테이블 생성 (todos)
-- Supabase SQL Editor에서 실행하세요.

CREATE TABLE IF NOT EXISTS public.todos (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT now() NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    is_completed BOOLEAN DEFAULT false NOT NULL,
    priority TEXT CHECK (priority IN ('low', 'medium', 'high')) DEFAULT 'medium' NOT NULL,
    due_date DATE
);

-- 2. RLS 활성화 및 정책 재설정
-- 'Failed to fetch' 에러가 발생한다면 RLS 정책이 없어서 발생하는 경우가 많습니다.
ALTER TABLE public.todos ENABLE ROW LEVEL SECURITY;

-- 기존 정책 삭제 (충돌 방지)
DROP POLICY IF EXISTS "Allow public select" ON public.todos;
DROP POLICY IF EXISTS "Allow public insert" ON public.todos;
DROP POLICY IF EXISTS "Allow public update" ON public.todos;
DROP POLICY IF EXISTS "Allow public delete" ON public.todos;

-- 정책 재생성
CREATE POLICY "Allow public select" ON public.todos FOR SELECT USING (true);
CREATE POLICY "Allow public insert" ON public.todos FOR INSERT WITH CHECK (true);
CREATE POLICY "Allow public update" ON public.todos FOR UPDATE USING (true);
CREATE POLICY "Allow public delete" ON public.todos FOR DELETE USING (true);

-- 3. 실시간 기능 활성화 (선택 사항)
-- ALTER publication supabase_realtime ADD TABLE public.todos;
